# AI健康助手大模型调用改善方案

## 问题分析
当前AI健康助手实现存在以下问题：
1. 多模型调用逻辑复杂，容易出错
2. Dify API调用配置可能不正确
3. 错误处理机制不完善
4. 缺少可靠的单一模型调用方案
5. 系统提示词构建与API调用分离

## 解决方案
简化模型调用逻辑，专注于Dify API（用户已提供有效API密钥），确保稳定可靠的大模型调用。

### 实施步骤

1. **简化AIChatRepository的模型调用逻辑**
   - 移除复杂的多模型切换逻辑
   - 专注于Dify API调用
   - 保留系统提示词构建功能
   - 完善错误处理机制

2. **确保Dify API调用配置正确**
   - 检查API端点URL
   - 验证请求格式
   - 确保API密钥正确传递
   - 完善响应解析

3. **优化系统提示词与上下文构建**
   - 确保系统提示词正确包含用户健康数据
   - 优化上下文传递方式
   - 确保消息历史正确处理

4. **完善错误处理机制**
   - 捕获并处理各种异常
   - 提供有用的错误信息
   - 确保不会返回fallback响应

### 预期效果
- AI助手能够稳定调用Dify API
- 不再返回fallback响应
- 能够正确处理用户请求
- 提供有用的健康建议
- 错误信息清晰有用

### 代码修改点
1. `AIChatRepository.kt`：简化模型调用逻辑，专注Dify API
2. `AIChatApi.kt`：确保Dify API调用配置正确
3. 移除复杂的多模型切换逻辑
4. 完善错误处理机制

### 测试验证
- 运行编译确保代码无错误
- 构建应用确保无构建错误
- 测试API调用确保能够获得正确响应
- 验证系统提示词正确传递

这个方案简单可靠，专注于单一模型调用，避免了复杂的多模型切换逻辑，确保能够稳定获得大模型的回答。